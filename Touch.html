<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Infinite Typing Trainer</title>
  <style>
    :root {
      --bg: #0b1020;
      --panel: #121933;
      --panel-2: #0f1530;
      --text: #e6ecff;
      --muted: #9eb0ff99;
      --accent: #7aa2ff;
      --good: #6ee7a8;
      --bad: #ff6b6b;
      --ring: 0 0 0 3px rgba(122, 162, 255, .25);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: monospace;
    }

    body {
      background-color: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 20px;
    }

    h1 {
      margin-bottom: 20px;
      color: var(--accent);
    }

    .panel {
      background-color: var(--panel);
      padding: 20px;
      border-radius: 10px;
      width: 100%;
      max-width: 900px;
      box-shadow: var(--ring);
      text-align: center;
      margin-bottom: 80px;
    }

    #typing-line {
      font-size: 2rem;
      margin-bottom: 20px;
      word-break: break-word;
      min-height: 50px;
    }

    #keyboard {
      display: grid;
      grid-template-columns: repeat(15, 1fr);
      gap: 5px;
      justify-items: center;
      margin-top: 20px;
    }

    .key {
      padding: 15px;
      min-width: 40px;
      text-align: center;
      background-color: var(--panel-2);
      border-radius: 5px;
      border: 2px solid var(--panel);
      user-select: none;
      box-shadow: 0 3px 0 rgba(0, 0, 0, 0.2);
      transition: all 0.1s;
    }

    .key.active {
      background-color: var(--accent);
      color: var(--bg);
      transform: translateY(2px);
    }

    .key.correct {
      background-color: var(--good);
      color: var(--bg);
      transform: translateY(2px);
    }

    .key.incorrect {
      background-color: var(--bad);
      color: var(--bg);
      transform: translateY(2px);
    }

    #difficulty {
      margin-bottom: 15px;
    }

    button {
      padding: 8px 12px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      background-color: var(--panel-2);
      color: var(--text);
      cursor: pointer;
    }

    button.active {
      background-color: var(--accent);
      color: var(--bg);
    }

    .bottom-stats {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: var(--panel);
      display: flex;
      justify-content: center;
      gap: 50px;
      padding: 15px 0;
      font-size: 1.5rem;
      font-weight: bold;
      box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.5);
      z-index: 10;
    }

    .bottom-stats span {
      color: var(--accent);
    }

    .top-img img {
      width: 650px;
      max-height: 550px;
      object-fit: fill;
      border-radius: 12px;
      border: 2px solid #1e2755;
      margin-bottom: 20px;
    }
  </style>
</head>

<body>

  <h1>Infinite Typing Trainer</h1>

  <div class="top-img">
    <img src="./TouchTypingKeyboardFingerChart.jpg" alt="Typing chart" />
  </div>

  <div id="difficulty">
    <button data-level="easy" class="active">Easy</button>
    <button data-level="medium">Medium</button>
    <button data-level="hard">Hard</button>
    <button data-level="common4">Common 4-Letter</button>
    <button data-level="above4">Above 4-Letter</button>
  </div>

  <div class="panel">
    <div id="typing-line">Loading drill...</div>
    <div id="keyboard"></div>
  </div>

  <div class="bottom-stats">
    <span>Words: <span id="words">0</span></span>
    <span>WPM: <span id="wpm">0</span></span>
    <span>Errors: <span id="errors">0</span></span>
    <span>Accuracy: <span id="accuracy">100%</span></span>
  </div>

  <!-- Error sound -->
  <audio id="error-sound" src="https://www.soundjay.com/buttons/sounds/button-22.mp3" preload="auto"></audio>

  <script>
    // --- drills: keys must match button data-level attributes ---
    const drills = {
      easy: [
        // Pure repeats
        "aaaa", "ssss", "dddd", "ffff", "gggg", "hhhh", "jjjj", "kkkk", "llll", ";;;;",

        // Alternating pairs
        "asas", "sasa", "dfdf", "fdfd", "jkjk", "kjkj", "l;l;", ";l;l",
        "gfgf", "hghg", "jhjh", "kjkj", ";k;k", "l;l;",

        // Classic sequences
        "asdf", "fdsa", "jkl;", ";lkj", "asdfjkl;", "fdsa;lkj", "asdjkl;", "kljasd",

        // Mixed short patterns
        "asjk", "df;l", "sa;j", "lk;d",
        "s;df", "ajkl", "fkja", "dl;s",
        "kjsa", "lf;d", "sd;f", "a;jk",

        // Extended home row practice
        "a;sldkfj", "f;djskla", "jaklfsd;", ";lkjasdf", "asdf;lkj", "lkjasdf;",

        // Double/triple drills
        "asdasd", "jkljkl", "dfgdfg", "hjkhjk", ";lk;lk", "asaasa", "jkjjkj",

        // Home row stretches
        "ghgh", "fgfg", "hjhj", "kjlk", "asgh", "dfhj", "jklh", "sdhj"
      ],
medium: [
        // Row drills + reverses
        "qwer", "rewq", "tyui", "iuyt", "opop", "poiu",
        "qwas", "erdf", "tygh", "uihj", "opkl",
        "qwerty", "ytrewq", "uiop", "poiu",
        "zxcv", "vcxz", "bnm,", ",mnb",
        "azsx", "qazx", "wsxc", "edcv", "rfvb", "tgby",
        "zxcvbn", "nbvcxz",

        // Diagonal drills
        "qaz", "wsx", "edc", "rfv", "tgb", "yhn", "ujm",
        "zaq", "xsw", "cde", "vfr", "bgt", "nhy", "mju",

        // Mixed patterns
        "aqsw", "zsexd", "qazwsx", "edcrfv",
        "pl;'", "okmn", "ijnb", "uhjm",
        "asdfqwer", "zxcvasdf",
        "asdf", "fdsa", "jkl;", ";lkj",
        "asdfasdf", "fdsafdsa",
        "jkl;jkl;", ";lkj;lkj",
        "asdfjkl;", "fsda;klj",

        // Longer vowel mixes
        "aeiou", "iouae", "oyea", "uiaeo", "yayoi",
        "ieaou", "ouaie", "uaeio", "eaiou", "yoaue",
        "aeioy", "iouya", "ueoai", "ayieu", "oeyui",
        "yuoai", "aieou", "oeiay", "euoia", "uyoae",

        // Extended vowel chains (extreme finger stretch)
        "aeiouy", "iouaey", "uoyaei", "eaiouy", "yaeiou",
        "iouyea", "aeioyu", "uieoya", "oyaieu", "yuoaei"
      ],
hard: [

        // Naming conventions
        "snake_case", "camelCase", "PascalCase", "kebab-case", "MixedUP_Case123",

        // Punctuation-heavy
        "--__",  "..,,", "!!??",  "::;;",  "\"\"''", "///\\\\",

        // Mixed complexity
        "Case123!", "@#$%^&*", "word_word!", "Var$Name",

      ],

common4: [
        // 2-letter essentials
        "of", "to", "in", "on", "at", "by", "as", "an", "or", "if",
        "is", "it", "he", "we", "be", "do", "me", "my", "no", "so",

        // 3-letter essentials
        "the", "and", "for", "not", "but", "you", "all", "any", "are", "can",
        "had", "her", "him", "his", "its", "out", "one", "new", "now", "too",

        // 4-letter essentials
        "this", "that", "with", "from", "your",
        "have", "they", "them", "what", "when",
        "will", "then", "some", "more", "well",
        "good", "like", "time", "work", "most"
      ],

above4: [
        // 5 letters (20)
        "about", "other", "which", "their", "there",
        "these", "would", "could", "first", "after",
        "where", "those", "place", "still", "every",
        "under", "while", "right", "small", "house",

        // 6 letters (20)
        "people", "number", "before", "little", "public",
        "within", "school", "always", "around", "second",
        "family", "worlds", "though", "change", "around",
        "friend", "market", "mother", "father", "social",

        // 7 letters (20)
        "because", "between", "without", "another", "through",
        "nothing", "general", "system", "against", "thought",
        "already", "service", "problem", "country", "example",
        "morning", "program", "special", "student", "history",

        // 8 letters (20)
        "children", "together", "business", "possible", "language",
        "interest", "question", "national", "important", "government",
        "company", "continue", "building", "cultural", "consider",
        "personal", "remember", "anything", "everyone", "services"
    ]
    };

    // --- state ---
    let currentLevel = "easy";
    let currentIndex = 0;
    let drillText = "";
    let words = 0;
    let errors = 0;
    let startTime = null;

    const typingLine = document.getElementById('typing-line');
    const wordsEl = document.getElementById('words');
    const wpmEl = document.getElementById('wpm');
    const errorsEl = document.getElementById('errors');
    const accuracyEl = document.getElementById('accuracy');
    const levelButtons = document.querySelectorAll("#difficulty button");

    const errorSound = document.getElementById('error-sound');
    let shuffledDrills = [];

    function shuffle(array) {
      if (!Array.isArray(array)) return [];
      let copy = [...array];
      for (let i = copy.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }

    function escapeHtml(str) {
      return String(str).replace(/&/g, '&amp;')
                        .replace(/</g, '&lt;')
                        .replace(/>/g, '&gt;')
                        .replace(/"/g, '&quot;')
                        .replace(/'/g, '&#39;');
    }

    function getNewDrill() {
      // if level missing, fallback safely to 'easy'
      if (!Array.isArray(drills[currentLevel]) || drills[currentLevel].length === 0) {
        console.warn(`No drills for level "${currentLevel}" â€” falling back to "easy".`);
        currentLevel = 'easy';
        levelButtons.forEach(b => b.classList.toggle('active', b.dataset.level === currentLevel));
      }

      if (shuffledDrills.length === 0) {
        shuffledDrills = shuffle(drills[currentLevel]);
      }

      if (!shuffledDrills || shuffledDrills.length === 0) {
        typingLine.textContent = 'No drills available for the selected level.';
        drillText = '';
        currentIndex = 0;
        return;
      }

      drillText = shuffledDrills.shift();
      currentIndex = 0;
      updateLine();
    }

    function updateLine() {
      if (!drillText) {
        typingLine.textContent = '';
        return;
      }
      let displayed = '';
      for (let i = 0; i < drillText.length; i++) {
        const ch = escapeHtml(drillText[i]);
        if (i < currentIndex) {
          displayed += `<span style="color:var(--good)">${ch}</span>`;
        } else if (i === currentIndex) {
          displayed += `<span style="color:var(--accent); text-decoration: underline">${ch}</span>`;
        } else {
          displayed += ch;
        }
      }
      typingLine.innerHTML = displayed;
    }

    function updateStats() {
      wordsEl.textContent = words;
      errorsEl.textContent = errors;
      const total = words + errors;
      const acc = total > 0 ? ((words / total) * 100).toFixed(1) : 100;
      accuracyEl.textContent = acc + "%";
      if (startTime) {
        const elapsedMinutes = (Date.now() - startTime) / 60000;
        const wpm = elapsedMinutes > 0 ? (words / elapsedMinutes).toFixed(1) : 0;
        wpmEl.textContent = wpm;
      }
    }

    levelButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        levelButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentLevel = btn.dataset.level;
        shuffledDrills = [];
        getNewDrill();
      });
    });

    // ignore long/non-character keys to avoid accidental crashes
    const IGNORE_KEYS = new Set([
      'Shift', 'Alt', 'Control', 'Meta', 'CapsLock', 'Tab', 'Escape',
      'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Enter', 'Backspace',
      'Insert', 'Home', 'End', 'PageUp', 'PageDown', 'ContextMenu'
    ]);

    document.addEventListener('keydown', e => {
      if (!startTime) startTime = Date.now();

      if (IGNORE_KEYS.has(e.key)) return;

      // prevent page scroll on spacebar but still treat it as a character
      if (e.key === ' ') e.preventDefault();

      // only accept single character keys plus space
      const key = (e.key.length === 1) ? e.key : (e.key === ' ' ? ' ' : null);
      if (key === null) return;

      if (!drillText) return;

      const expected = drillText[currentIndex];

      if (key === expected) {
        currentIndex++;
      } else {
        errors++;
        try { errorSound.currentTime = 0; errorSound.play(); } catch (err) { /* ignore audio errors */ }
      }

      if (currentIndex >= drillText.length) {
        words++;
        updateStats();
        getNewDrill();
      } else {
        updateLine();
        updateStats();
      }
    });

    // initial drill
    getNewDrill();
  </script>
</body>

</html>